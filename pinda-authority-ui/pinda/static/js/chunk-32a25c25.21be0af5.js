(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32a25c25"],{"73a8":function(e,t,i){},c2cf:function(e,t,i){"use strict";var a=i("9256"),n=i("5657"),r={dictionaryEnums:"/gate/dictionary/enums"};t["a"]={uploadFile:"".concat("http://localhost:8760").concat("/api","/file/attachment/upload"),loadImg:function(e){var t=n["a"].get("TOKEN",""),i=n["a"].get("TENANT","");return"".concat("http://localhost:8760").concat("/api","/file/attachment/download/").concat(e.bizType,"/").concat(e.bizId,"?token=").concat(t,"&tenant=").concat(i)},dictionaryEnums:function(){return Object(a["a"])({method:"GET",url:r.dictionaryEnums})},generateId:function(e){return Object(a["a"])({url:"/authority/common/generateId",method:"GET",data:e})},getAttachment:function(e){return Object(a["a"])({url:"/file/attachment",method:"get",data:e})},deleteAttachment:function(e){return Object(a["a"])({url:"/file/attachment",method:"delete",data:e})},downloadAttachment:function(e){return Object(a["a"])({url:"/file/attachment/download",method:"get",responseType:"blob",data:e})},downloadAttachmentBiz:function(e){return Object(a["a"])({url:"/file/attachment/download/biz",method:"get",responseType:"blob",data:e})}}},dfdf:function(e,t,i){"use strict";var a=i("73a8"),n=i.n(a);n.a},f514:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"close-on-click-modal":!1,title:e.title,type:e.type,visible:e.isVisible,width:e.width,top:"50px"},on:{"update:visible":function(t){e.isVisible=t},dragDialog:e.handleDrag}},[i("el-form",{ref:"form",attrs:{model:e.attachment,rules:e.rules,"label-position":"right","label-width":"100px"}},[i("el-form-item",{attrs:{label:e.$t("table.attachment.bizId"),prop:"bizId"}},[i("el-input",{model:{value:e.attachment.bizId,callback:function(t){e.$set(e.attachment,"bizId",t)},expression:"attachment.bizId"}})],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("table.attachment.bizType"),prop:"bizType"}},[i("el-input",{model:{value:e.attachment.bizType,callback:function(t){e.$set(e.attachment,"bizType",t)},expression:"attachment.bizType"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"文件",prop:"fileLength"}},[i("fileUpload",{ref:"fileRef",attrs:{"accept-size":2097152,"auto-upload":!1,limit:5},on:{fileLengthVaild:e.fileLengthVaild,setId:e.setIdAndSubmit}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("文件不超过2MB")])],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){e.isVisible=!1}}},[e._v(e._s(e.$t("common.cancel")))]),e._v(" "),i("el-button",{attrs:{disabled:e.disabled,plain:"",type:"primary"},on:{click:e.submitForm}},[e._v(e._s(e.$t("common.confirm")))])],1)],1)},n=[],r=i("db72"),o=(i("a481"),i("6762"),i("2fdb"),{bind:function(e,t,i){var a=e.querySelector(".el-dialog__header"),n=e.querySelector(".el-dialog");a.style.cssText+=";cursor:move;",n.style.cssText+=";top:0px;";var r=function(){return window.document.currentStyle?function(e,t){return e.currentStyle[t]}:function(e,t){return getComputedStyle(e,!1)[t]}}();a.onmousedown=function(e){var t=e.clientX-a.offsetLeft,o=e.clientY-a.offsetTop,l=n.offsetWidth,s=n.offsetHeight,c=document.body.clientWidth,d=document.body.clientHeight,u=n.offsetLeft,f=c-n.offsetLeft-l,m=n.offsetTop,h=d-n.offsetTop-s,p=r(n,"left"),g=r(n,"top");p.includes("%")?(p=+document.body.clientWidth*(+p.replace(/\%/g,"")/100),g=+document.body.clientHeight*(+g.replace(/\%/g,"")/100)):(p=+p.replace(/\px/g,""),g=+g.replace(/\px/g,"")),document.onmousemove=function(e){var a=e.clientX-t,r=e.clientY-o;-a>u?a=-u:a>f&&(a=f),-r>m?r=-m:r>h&&(r=h),n.style.cssText+=";left:".concat(a+p,"px;top:").concat(r+g,"px;"),i.child.$emit("dragDialog")},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}}}),l=function(e){e.directive("el-drag-dialog",o)};window.Vue&&(window["el-drag-dialog"]=o,Vue.use(l)),o.install=l;var s=o,c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-upload",{ref:e.uploadRef,staticClass:"upload-demo",class:!1===e.isUpload?"hidebtn":"",attrs:{accept:e.accept,action:e.action,"auto-upload":e.autoUpload,"before-remove":e.beforeRemove,data:e.fileOtherData,"file-list":e.fileList,headers:e.headers,limit:e.limit,multiple:e.multiple,"on-change":e.handleChange,"on-error":e.handleError,"on-exceed":e.handleExceed,"on-preview":e.handlePreview,"on-remove":e.handleRemove}},[e.isUpload?i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]):e._e()],1)],1)},d=[],u=(i("96cf"),i("3b8d")),f=(i("ac6a"),i("7f7f"),i("c5f6"),i("5657")),m=i("c2cf"),h={name:"FileUpload",props:{uploadRef:{type:String,default:"file1"},multiple:{type:Boolean,default:!0},autoUpload:{type:Boolean,default:!0},isUpload:{type:Boolean,default:!0},limit:{type:Number,default:null},accept:{type:String,default:""},acceptSize:{type:Number,default:null},fileOtherData:{type:Object,default:function(){return{id:null,bizId:"",bizType:"",isSingle:!1}}}},data:function(){return{fileList:[],removeFileAry:[],addFileAry:[],successNum:0,errorNum:0,uploadTotalNum:0,isUploadError:!1,action:"".concat("/api","/file/attachment/upload")}},computed:{headers:function(){return{token:f["a"].get("TOKEN","")||"",tenant:f["a"].get("TENANT","")||""}}},methods:{init:function(e){var t=e.id,i=e.bizId,a=e.bizType,n=e.isSingle,r=e.isDetail,o=this;o.fileOtherData.bizId=i,o.fileOtherData.id=t||"",o.fileOtherData.bizType=a,o.fileOtherData.isSingle=n||!1,o.fileList.length=0,o.removeFileAry=[],o.addFileAry=[],o.$emit("fileLengthVaild",0),r&&o.getAttachment(),o.successNum=0,o.errorNum=0,o.uploadTotalNum=0,o.$refs[o.uploadRef].clearFiles()},handleChange:function(e,t){var i=this;if(e.response)i.uploadTotalNum+=1,e.response.isSuccess?(i.fileOtherData.bizId=e.response.data.bizId,i.successNum+=1):(setTimeout((function(){i.$message({message:e.name+"上传失败，原因：\n"+e.response.msg,type:"error",showClose:!0,duration:6e3})}),0),i.isUploadError=!1,i.errorNum+=1),i.$emit("setId",i.uploadTotalNum===t.length,e.response);else{if(i.acceptSize){var a=e.size>i.acceptSize;a?(setTimeout((function(){i.$message.error("只能上传"+i.renderSize(i.acceptSize)+"的文件!已为您过滤文件："+e.name)}),10),t.forEach((function(i,a){i.uid===e.uid&&t.splice(a,1)}))):(i.isUploadError||i.addFileAry.push(e.name),i.isUploadError=!1)}else i.isUploadError||i.addFileAry.push(e.name),i.isUploadError=!1;i.$emit("fileLengthVaild",i.fileList.length+i.addFileAry.length)}i.$store.state.hasLoading=!1},handleError:function(){var e=this;e.$message.error("附件上传失败，请重试"),e.isUploadError=!0,e.$store.state.hasLoading=!1},renderSize:function(e){if(null==e||""==e)return"0 B";var t=new Array("B","KB","MB","GB","TB","PB","EB","ZB","YB"),i=0,a=parseFloat(e);i=Math.floor(Math.log(a)/Math.log(1024));var n=a/Math.pow(1024,i);return n=n.toFixed(2),t[i]?n+t[i]:"文件太大"},handlePreview:function(e){e.bizId&&this.downLoadFile(e)},beforeRemove:function(e){return this.$confirm("确定移除"+e.name,"删除确认")},handleExceed:function(){var e=this;e.$message("当前最多允许上传"+e.limit+"个文件")},handleRemove:function(e){var t=this;e.bizId?(t.removeFileAry.push(e.id),t.fileList.map((function(i,a){if(i.name===e.name)return t.fileList.splice(a,1),!1}))):t.addFileAry.map((function(i,a){if(i===e.name)return t.addFileAry.splice(a,1),!1})),t.$emit("fileLengthVaild",t.fileList.length+t.addFileAry.length)},deleteAttachment:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,m["a"].deleteAttachment({ids:t.removeFileAry});case 3:i=e.sent,200===i.status&&(0!==i.data.code?t.$message(i.data.msg):t.removeFileAry=[]);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getAttachment:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,m["a"].getAttachment({bizIds:t.fileOtherData.bizId,bizTypes:t.fileOtherData.bizType});case 3:i=e.sent,200===i.status&&0===i.data.code&&i.data.data.length>0&&(a=i.data.data[0].list,a.map((function(e){e.name=e.submittedFileName})),t.fileList=a,t.$emit("fileLengthVaild",t.fileList.length));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getAttachmentByArr:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=this,e.next=3,m["a"].getAttachment({bizIds:t,bizTypes:i});case 3:n=e.sent,200===n.status&&0===n.data.code&&n.data.data.length>0&&(r=n.data.data[0].list,r.map((function(e){e.name=e.submittedFileName})),a.fileList=r);case 5:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}(),handleBack:function(){var e=this;return{addLength:e.addFileAry.length,removeLength:e.removeFileAry.length}},submitFile:function(e,t,i){var a=this;a.fileOtherData.id=e,t&&(a.fileOtherData.bizId=t,a.isUpload=!0),a.fileOtherData.bizType=i,a.$refs[a.uploadRef].submit(),a.addFileAry=[]},downLoadFile:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=document.createElement("a"),i.href=t.url,i.download=t.name,i.click(),window.URL.revokeObjectURL(i.href);case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}},p=h,g=(i("dfdf"),i("2877")),b=Object(g["a"])(p,c,d,!1,null,null,null),v=b.exports,y={name:"AttachmentEdit",directives:{elDragDialog:s,fileUpload:v},components:{fileUpload:v},props:{dialogVisible:{type:Boolean,default:!1},type:{type:String,default:"add"}},data:function(){var e=this;return{accept:"image/jpeg, image/gif, image/png",attachment:this.initAttachment(),screenWidth:0,width:this.initWidth(),fileLength:0,disabled:!1,rules:{bizType:[{required:!0,message:this.$t("rules.require"),trigger:"blur"},{min:0,max:255,message:this.$t("rules.range0to255"),trigger:"blur"}],bizId:{min:0,max:255,message:this.$t("rules.range0to255"),trigger:"blur"},fileLength:{required:!0,trigger:"change",validator:function(t,i,a){var n=e;0===n.fileLength?a(new Error("请上传文件")):n.fileLength>5?a(new Error("一次性只能上传5个文件")):a()}}}}},computed:{isVisible:{get:function(){return this.dialogVisible},set:function(){this.close(),this.reset()}},title:function(){return this.$t("common.upload")}},watch:{},mounted:function(){var e=this;window.onresize=function(){return function(){e.width=e.initWidth()}()}},methods:{initAttachment:function(){return{id:"",bizId:"",bizType:"",file:null,isSingle:!1}},handleDrag:function(){console.log("我被拖动了")},fileLengthVaild:function(e){var t=this;t.fileLength=e||0},initWidth:function(){return this.screenWidth=document.body.clientWidth,this.screenWidth<991?"90%":this.screenWidth<1400?"45%":"800px"},setAttachment:function(e){var t=this;e&&(t.attachment=Object(r["a"])({},e))},close:function(){this.$emit("close")},reset:function(){this.$refs.form.clearValidate(),this.$refs.form.resetFields(),this.attachment=this.initAttachment(),this.$refs.fileRef.init({id:"",bizId:"",bizType:""})},submitForm:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.editSubmit()}))},editSubmit:function(){var e=this;e.disabled=!0,e.$refs.fileRef.submitFile(this.attachment.id,this.attachment.bizId,this.attachment.bizType)},setIdAndSubmit:function(e){var t=this;e&&(t.disabled=!1,t.isVisible=!1,t.$message({message:t.$t("tips.createSuccess"),type:"success"}),t.$emit("success"))}}},w=y,z=Object(g["a"])(w,a,n,!1,null,"902e05fc",null);t["default"]=z.exports}}]);